<div class="container">
  <div class="row py-4">
    <div class="col">
      <h1 class="mb-5">Billing information & settings</h1>

      <div class="my-2">
        <h2>Subscription</h2>
        <% if user_signed_in? && current_user.subscribed? %>
          <ul>
            <li>Plan: <%= @plan.name %></li>
            <li>Price: <%= humanized_money_with_symbol(@plan.price) %><span>/month</span></li>
            <li>Start date: <%= Time.at(@subscription.start_date).strftime("%A, %d %b %Y %l:%M %p") %></li>
            <li>Billing card: <%= @default_payment_method["card"]["brand"].capitalize %>****<%= @default_payment_method["card"]["last4"] %> <em>(exp <%= @default_payment_method["card"]["exp_month"] %>/<%= @default_payment_method["card"]["exp_year"] %>)</em></li>
          </ul>
        <% else %>
          <p>You have no subscription yet.</p>
        <% end %>
      </div>

      <hr>
      <div class="my-2">
        <div class="d-flex justify-content-between mb-3">
          <h2>Payment cards (<%= @cards.size %>) </h2>
          <button id="add-card" class="btn btn-primary">Add a new card</button>
        </div>
        <ul style="list-style: none;">
          <% @cards.each do |card| %>
            <li class="mb-2"><%= render 'shared/selectpaymentcard', card: card %></li>
          <% end %>
        </ul>

      </div>

      <script src="https://js.stripe.com/v3/"></script>
      <script>
        const paymentButton = document.getElementById('add-card');
        paymentButton.addEventListener('click', () => {
          const stripe = Stripe('<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>');
          stripe.redirectToCheckout({
            sessionId: '<%= @session.checkout_session_id %>'
          });
        });
      </script>

    </div>
  </div>
</div>
